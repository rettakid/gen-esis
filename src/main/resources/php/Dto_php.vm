<?php

class Dto {

	public function printData(${H}app)	{
		if (true)	{
			${H}this->printXml(${H}app);
		} else {
			${H}this->printJson(${H}app);
		}
	}

	public function printXml(${H}app)	{
		${H}res = ${H}app->response();
		${H}res['Content-Type'] = 'text/xml';

		${H}reflect = new \ReflectionClass(${H}this);
		${H}className = ${H}reflect->getShortName();
		${H}classVars = ${H}reflect->getMethods();
		${H}displayClassName = strtolower(${H}className);

		echo "<${H}displayClassName>";
		foreach (${H}classVars as ${H}classVar)	{
			${H}methodName = ${H}classVar->getName();
			if (substr(${H}methodName,0,3) == "get")	{
				${H}displayName = substr(${H}methodName,3,strlen(${H}methodName) - 3);
				${H}methodValue = ${H}this->${H}methodName();
				${H}displayName = strtolower(${H}displayName);
				if (is_array(${H}methodValue)) {
					echo "<${H}displayName>";
					foreach (${H}methodValue as ${H}item) {
						${H}item->printXml(${H}app);
					}
					echo "</${H}displayName>";
				} elseif (${H}methodValue instanceof DateTime)	{
					${H}displayMethodValue = ${H}methodValue->format('Y-m-d H:i:s').'.9 SAST';
					echo "<${H}displayName>${H}displayMethodValue</${H}displayName>";
				} elseif (${H}methodValue instanceof Dto)	{
					${H}methodValue->printXml(${H}app);
				}  else 	{
					echo "<${H}displayName>${H}methodValue</${H}displayName>";
				}
			}
			
		}
		echo "</${H}displayClassName>";
	}

	public function bindXml(${H}app)	{
		${H}reflect = new \ReflectionClass(${H}this);
		${H}className = ${H}reflect->getShortName();
		${H}classVars = ${H}reflect->getMethods();
		${H}body = ${H}app->request()->getBody();
        ${H}xml = simplexml_load_string(${H}body);
		foreach (${H}classVars as ${H}classVar)	{
			${H}methodName = ${H}classVar->getName();
			${H}displayName = strtolower(ucwords(substr(${H}methodName,3,strlen(${H}methodName) - 3)));
			if (substr(${H}methodName,0,3) == "set")	{
				${H}data = ${H}xml->${H}displayName;
				${H}this->${H}methodName(${H}data);
			}
		}
	}

	public function printJson(${H}app)	{
		${H}res = ${H}app->response();
		${H}res['Content-Type'] = 'text/json';
		${H}class_name = get_class(${H}this);
		${H}class_vars = get_class_vars(${H}class_name);
		echo "{";
		foreach (${H}class_vars as ${H}name => ${H}value) {
			${H}this_value = ${H}this->${H}name;
			if (${H}this_value instanceof dto)	{
				${H}sub_class_name = get_class(${H}this->${H}name);
				echo "${H}sub_class_name : ";
				${H}this->${H}name->print_json(${H}app);
				echo ",";
			} else 	{
				echo "${H}name : '${H}this_value',";
			}
		}
		echo "}";
	}

}

?>